<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/library/'</script><script charset="utf-8" src="../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Leuk: Cox regression · JuliaBUGS.jl</title><script data-outdated-warner="" src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script data-main="../../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../../assets/themeswap.js"></script><link href="../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/multidoc-custom.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><div class="nav-dropdown"><button class="nav-item dropdown-label">Modelling languages</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../DynamicPPL/">DynamicPPL</a><a class="nav-link active nav-item" href="../../../">JuliaBUGS</a><a class="nav-link nav-item" href="../../../../TuringGLM/">TuringGLM</a></ul></div><div class="nav-dropdown"><button class="nav-item dropdown-label">MCMC</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../AdvancedHMC/">AdvancedHMC</a><a class="nav-link nav-item" href="../../../../AbstractMCMC/">AbstractMCMC</a><a class="nav-link nav-item" href="../../../../ThermodynamicIntegration/">ThermodynamicIntegration</a><a class="nav-link nav-item" href="../../../../AdvancedPS/">AdvancedPS</a><a class="nav-link nav-item" href="../../../../EllipticalSliceSampling/">EllipticalSliceSampling</a><a class="nav-link nav-item" href="../../../../NestedSamplers/">NestedSamplers</a></ul></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Diagnostics</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../MCMCChains/">MCMCChains</a><a class="nav-link nav-item" href="../../../../MCMCDiagnosticTools/">MCMCDiagnosticTools</a><a class="nav-link nav-item" href="../../../../ParetoSmooth/">ParetoSmooth</a></ul></div><a class="nav-link nav-item" href="../../../../Bijectors/">Bijectors</a><a class="nav-link nav-item" href="../../../../TuringCallbacks/">TuringCallbacks</a><a class="nav-link nav-item" href="../../../../TuringBenchmarking/">TuringBenchmarking</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Gaussian Processes</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../AbstractGPs/">AbstractGPs</a><a class="nav-link nav-item" href="../../../../KernelFunctions/">KernelFunctions</a><a class="nav-link nav-item" href="../../../../ApproximateGPs/">ApproximateGPs</a></ul></div><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JuliaBUGS.jl</a></span></div><form action="../../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../example/">Example</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/">General</a></li><li><a class="tocitem" href="../../functions/">Functions</a></li><li><a class="tocitem" href="../../distributions/">Distributions</a></li><li><a class="tocitem" href="../../user_defined_functions/">User-defined Functions and Distributions</a></li></ul></li><li><a class="tocitem" href="../../graph_plotting/">Plotting</a></li><li><a class="tocitem" href="../../R_interface/">R Interface</a></li><li><a class="tocitem" href="../../pitfalls/">Pitfalls</a></li><li><span class="tocitem">For Developers</span><ul><li><a class="tocitem" href="../../parser/">Parser</a></li><li><a class="tocitem" href="../../BUGS_notes/">Notes on BUGS Implementations</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">Leuk: Cox regression</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Leuk: Cox regression</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TuringLang/JuliaBUGS.jl/blob/master/docs/src/bugs_examples/Leuk.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Leuk:-Cox-regression"><a class="docs-heading-anchor" href="#Leuk:-Cox-regression">Leuk: Cox regression</a><a id="Leuk:-Cox-regression-1"></a><a class="docs-heading-anchor-permalink" href="#Leuk:-Cox-regression" title="Permalink"></a></h1><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p>Several authors have discussed Bayesian inference for censored survival data where the integrated baseline hazard function is to be estimated non-parametrically, including Kalbfleisch (1978), Kalbfleisch and Prentice (1980), Clayton (1991), and Clayton (1994).  Clayton (1994) formulates the Cox model using counting process notation introduced by Andersen and Gill (1982) and discusses estimation of the baseline hazard and regression parameters using MCMC methods.  Although this approach may seem somewhat contrived, it lays the groundwork for extensions to random effect (frailty) models, time-dependent covariates, smoothed hazards, multiple events, and more.  Below is how to implement this formulation of the Cox model in BUGS.</p><p>For subjects <span>$i = 1,...,n$</span>, we observe processes <span>$N_i(t)$</span> which count the number of failures up to time <span>$t$</span>. The corresponding intensity process <span>$I_i(t)$</span> is given by</p><p class="math-container">\[I_i(t) \, dt = \mathbb{E}[dN_i(t) \, | \, \mathcal{F}_{t-}]\]</p><p>where <span>$dN_i(t)$</span> is the increment of <span>$N_i$</span> over the interval <span>$[t, t+dt)$</span>, and <span>$\mathcal{F}_{t-}$</span> represents the available data just before time <span>$t$</span>. If subject <span>$i$</span> fails during this interval, <span>$dN_i(t) = 1$</span>; otherwise, <span>$dN_i(t) = 0$</span>. Hence, <span>$\mathbb{E}(dN_i(t) | \mathcal{F}_{t-})$</span> corresponds to the probability of subject <span>$i$</span> failing in the interval <span>$[t, t+dt)$</span>. As <span>$dt \to 0$</span>, this probability becomes the instantaneous hazard at time <span>$t$</span> for subject <span>$i$</span>, assumed to have the form</p><p class="math-container">\[I_i(t) = Y_i(t)\lambda_0(t) \exp(\beta z_i)\]</p><p>where <span>$Y_i(t)$</span> is an observed process taking the value 1 or 0 according to whether subject <span>$i$</span> is at risk at time <span>$t$</span>, and <span>$\lambda_0(t) \exp(\beta z_i)$</span> is the Cox regression model. Thus, the observed data <span>$D = \{N_i(t), Y_i(t), z_i\}; i = 1,...,n$</span> and unknown parameters <span>$\beta$</span> and <span>$\Lambda_0(t) = \int_0^t \lambda_0(u) du$</span>, the latter estimated non-parametrically.</p><p>The joint posterior distribution is</p><p class="math-container">\[P(\beta, \Lambda_0() | D) \propto P(D | \beta, \Lambda_0()) P(\beta) P(\Lambda_0())\]</p><p>For BUGS, specify the likelihood <span>$P(D | \beta, \Lambda_0())$</span> and priors for <span>$\beta$</span> and <span>$\Lambda_0()$</span>. Under non-informative censoring, the data likelihood is</p><p class="math-container">\[\prod_{i=1}^{n} \left( \prod_{t \geq 0} I_i(t) dN_i(t) \right) \exp(- I_i(t) dt)\]</p><p>Viewing the increments <span>$dN_i(t)$</span> as independent Poisson variables with means <span>$I_i(t)dt$</span>:</p><p class="math-container">\[dN_i(t) \sim \text{Poisson}(I_i(t)dt)\]</p><p class="math-container">\[I_i(t)dt = Y_i(t) \exp(\beta z_i) d\Lambda_0(t)\]</p><p>where (d\Lambda<em>0(t) = \Lambda</em>0(t)dt) is the increment or jump in the integrated baseline hazard function occurring during the time interval ([t, t+dt)). Since the conjugate prior for the Poisson mean is the gamma distribution, it would be convenient if (\Lambda<em>0()) were a process in which the increments (d\Lambda</em>0(t)) are distributed according to gamma distributions. We assume the conjugate independent increments prior suggested by Kalbfleisch (1978), namely   </p><p class="math-container">\[d\Lambda_0(t) \sim \text{Gamma}(c \cdot d\Lambda^*_0(t), c)\]</p><p>Here, <span>$d\Lambda^*_0(t)$</span> can be thought of as a prior guess at the unknown hazard function, with <span>$c$</span> representing the degree of confidence in this guess. Small values of <span>$c$</span> correspond to weak prior beliefs. In the example below, we set <span>$d\Lambda^*_0(t) = r \cdot dt$</span> where <span>$r$</span> is a guess at the failure rate per unit time, and <span>$dt$</span> is the size of the time interval.    </p><p>The above formulation is appropriate when genuine prior information exists concerning the underlying hazard function. Alternatively, if we wish to reproduce a Cox analysis but with, say, additional hierarchical structure, we may use the Multinomial-Poisson trick described in the BUGS manual. This is equivalent to assuming independent increments in the cumulative <code>non-informative</code> priors. This formulation is also shown below.</p><p>The fixed effect regression coefficients (b) are assigned a vague prior</p><p class="math-container">\[b \sim \text{Normal}(0.0, 0.000001)\]</p><h2 id="BUGS-code-for-the-Leuk-example:"><a class="docs-heading-anchor" href="#BUGS-code-for-the-Leuk-example:">BUGS code for the <code>Leuk</code> example:</a><a id="BUGS-code-for-the-Leuk-example:-1"></a><a class="docs-heading-anchor-permalink" href="#BUGS-code-for-the-Leuk-example:" title="Permalink"></a></h2><pre><code class="language-bugs hljs">model
{
    # Set up data
    for(i in 1:N) {
    for(j in 1:T) {
        # risk set = 1 if obs.t &gt;= t
        Y[i,j] &lt;- step(obs.t[i] - t[j] + eps)
        # counting process jump = 1 if obs.t in [ t[j], t[j+1] )
        # i.e. if t[j] &lt;= obs.t &lt; t[j+1]
        dN[i, j] &lt;- Y[i, j] * step(t[j + 1] - obs.t[i] - eps) * fail[i]
    }
    }
    # Model
    for(j in 1:T) {
        for(i in 1:N) {
            dN[i, j] ~ dpois(Idt[i, j]) # Likelihood
            Idt[i, j] &lt;- Y[i, j] * exp(beta * Z[i]) * dL0[j]    # Intensity
        }
        dL0[j] ~ dgamma(mu[j], c)
        mu[j] &lt;- dL0.star[j] * c # prior mean hazard

        # Survivor function = exp(-Integral{l0(u)du})^exp(beta*z)
        S.treat[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * -0.5));
        S.placebo[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * 0.5));   
    }
    # Priors
    c &lt;- 0.001
    r &lt;- 0.1
    for (j in 1 : T) {
        dL0.star[j] &lt;- r * (t[j + 1] - t[j])
    }
    beta ~ dnorm(0.0,0.000001)
}</code></pre><h2 id="Reference-Results"><a class="docs-heading-anchor" href="#Reference-Results">Reference Results</a><a id="Reference-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Reference-Results" title="Permalink"></a></h2><table><tbody><tr><th style="text-align: right">Variable</th><th style="text-align: right">Mean</th><th style="text-align: right">Median</th><th style="text-align: right">Standard Deviation</th><th style="text-align: right">Monte Carlo Error</th><th style="text-align: right">2.5% Value</th><th style="text-align: right">97.5% Value</th><th style="text-align: right">Start</th><th style="text-align: right">Sample</th><th style="text-align: right">ESS</th></tr><tr><td style="text-align: right">S.placebo[1]</td><td style="text-align: right">0.9264</td><td style="text-align: right">0.9374</td><td style="text-align: right">0.04989</td><td style="text-align: right">3.349E-4</td><td style="text-align: right">0.8029</td><td style="text-align: right">0.9909</td><td style="text-align: right">1001</td><td style="text-align: right">20000</td><td style="text-align: right">22184</td></tr><tr><td style="text-align: right">S.placebo[17]</td><td style="text-align: right">0.04431</td><td style="text-align: right">0.03344</td><td style="text-align: right">0.03909</td><td style="text-align: right">2.698E-4</td><td style="text-align: right">0.002478</td><td style="text-align: right">0.1487</td><td style="text-align: right">1001</td><td style="text-align: right">20000</td><td style="text-align: right">20992</td></tr><tr><td style="text-align: right">S.treat[1]</td><td style="text-align: right">0.9826</td><td style="text-align: right">0.9863</td><td style="text-align: right">0.01413</td><td style="text-align: right">1.074E-4</td><td style="text-align: right">0.9457</td><td style="text-align: right">0.9982</td><td style="text-align: right">1001</td><td style="text-align: right">20000</td><td style="text-align: right">17315</td></tr><tr><td style="text-align: right">S.treat[17]</td><td style="text-align: right">0.4767</td><td style="text-align: right">0.4763</td><td style="text-align: right">0.1198</td><td style="text-align: right">0.001009</td><td style="text-align: right">0.2474</td><td style="text-align: right">0.7086</td><td style="text-align: right">1001</td><td style="text-align: right">20000</td><td style="text-align: right">14104</td></tr><tr><td style="text-align: right">beta</td><td style="text-align: right">1.539</td><td style="text-align: right">1.524</td><td style="text-align: right">0.4211</td><td style="text-align: right">0.0034</td><td style="text-align: right">0.7475</td><td style="text-align: right">2.388</td><td style="text-align: right">1001</td><td style="text-align: right">20000</td><td style="text-align: right">15340</td></tr></tbody></table></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 15 March 2024 12:53">Friday 15 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>